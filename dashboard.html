
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lulla - Medical Admin Templates & Dashboards</title>

    <!-- Meta -->
    <meta name="description" content="Marketplace for Bootstrap Admin Dashboards">
    <meta property="og:title" content="Admin Templates - Dashboard Templates">
    <meta property="og:description" content="Marketplace for Bootstrap Admin Dashboards">
    <meta property="og:type" content="Website">
    <link rel="shortcut icon" href="assets/images/favicon.svg">

    <!-- *************
		************ CSS Files *************
	************* -->
    <link rel="stylesheet" href="assets/css/remixicon.css">
    <link rel="stylesheet" href="assets/css/main.min.css">
    
    <!-- Theme Color Override -->
    <style>
      :root {
        --logo-flow: #15696B;
        --bs-primary: var(--logo-flow);
        --bs-primary-rgb: 21, 105, 107;
        --bs-link-color: var(--logo-flow);
        --bs-link-hover-color: #0F4449;
      }
      
      .app-header {
         background-color: white !important;
       }
      
      /* Export Icons Styling */
      .export-icons-container {
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
        height: 38px;
      }
      
      .export-icon-btn {
        background: none;
        border: 1px solid #ccc;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1.3em;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 38px;
        height: 38px;
      }
      
      .export-excel-btn i {
        color: #00a651;
      }
      
      .export-pdf-btn i {
        color: #d32f2f;
      }
      
      .export-icon-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      
      .export-excel-btn:hover {
        border-color: #00a651;
        background-color: rgba(0, 166, 81, 0.05);
      }
      
      .export-pdf-btn:hover {
        border-color: #d32f2f;
        background-color: rgba(211, 47, 47, 0.05);
      }
    </style>

    <!-- *************
		************ Vendor Css Files *************
	************ -->

    <!-- Scrollbar CSS -->
    <link rel="stylesheet" href="assets/css/OverlayScrollbars.min.css">
  </head>

  <body>

    <!-- Loading starts -->
    <div id="loading-wrapper">
      <div class='spin-wrapper'>
        <div class='spin'>
          <div class='inner'></div>
        </div>
        <div class='spin'>
          <div class='inner'></div>
        </div>
        <div class='spin'>
          <div class='inner'></div>
        </div>
        <div class='spin'>
          <div class='inner'></div>
        </div>
        <div class='spin'>
          <div class='inner'></div>
        </div>
        <div class='spin'>
          <div class='inner'></div>
        </div>
      </div>
    </div>
    <!-- Loading ends -->

    <!-- Page wrapper starts -->
    <div class="page-wrapper">

      <!-- App header starts -->
      <div class="app-header d-flex align-items-center">

        <!-- Toggle buttons starts -->
        <div class="d-flex">
          <button class="toggle-sidebar">
            <i class="ri-menu-line"></i>
          </button>
          <button class="pin-sidebar">
            <i class="ri-menu-line"></i>
          </button>
        </div>
        <!-- Toggle buttons ends -->

        <!-- App brand starts -->
        <div class="app-brand ms-3">
          <a href="index.html" class="d-lg-block d-none">
            <img src="logo/logo.svg" class="logo" alt="HealthFlow Admin Template">
          </a>
          <a href="index.html" class="d-lg-none d-md-block">
            <img src="logo/logo.svg" class="logo" alt="HealthFlow Admin Template">
          </a>
        </div>
        <!-- App brand ends -->

        <!-- App header actions starts -->
        <div class="header-actions">

          <!-- Search container starts -->
          <div class="search-container d-lg-block d-none mx-3">
            <input type="text" class="form-control" id="searchId" placeholder="Search">
            <i class="ri-search-line"></i>
          </div>
          <!-- Search container ends -->

          <!-- Header actions starts -->
          <div class="d-lg-flex d-none gap-2">

            <!-- Select country dropdown starts -->
            <div class="dropdown">
              <a class="dropdown-toggle header-icon" href="#!" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <img src="assets/images/flags/1x1/fr.svg" class="header-country-flag" alt="Bootstrap Dashboards">
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-mini">
                <div class="country-container">
                  <a href="index.html" class="py-2">
                    <img src="assets/images/flags/1x1/us.svg" alt="Admin Panel">
                  </a>
                  <a href="index.html" class="py-2">
                    <img src="assets/images/flags/1x1/in.svg" alt="Admin Panels">
                  </a>
                  <a href="index.html" class="py-2">
                    <img src="assets/images/flags/1x1/br.svg" alt="Admin Dashboards">
                  </a>
                  <a href="index.html" class="py-2">
                    <img src="assets/images/flags/1x1/tr.svg" alt="Admin Templatess">
                  </a>
                  <a href="index.html" class="py-2">
                    <img src="assets/images/flags/1x1/gb.svg" alt="Google Admin">
                  </a>
                </div>
              </div>
            </div>
            <!-- Select country dropdown ends -->

            <!-- Notifications dropdown starts -->
            <div class="dropdown">
              <a class="dropdown-toggle header-icon" href="#!" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="ri-list-check-3"></i>
                <span class="count-label warning"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-300">
                <h5 class="fw-semibold px-3 py-2 text-primary">Activity</h5>

                <!-- Scroll starts -->
                <div class="scroll300">

                  <!-- Activity List Starts -->
                  <div class="p-3">
                    <ul class="p-0 activity-list2">
                      <li class="activity-item pb-3 mb-3">
                        <a href="#!">
                          <h5 class="fw-regular">
                            <i class="ri-circle-fill text-danger me-1"></i>
                            Invoices.
                          </h5>
                          <div class="ps-3 ms-2 border-start">
                            <div class="d-flex align-items-center mb-2">
                              <div class="flex-shrink-0">
                                <img src="assets/images/products/1.jpg" class="img-shadow img-3x rounded-1"
                                  alt="Hospital Admin Templates">
                              </div>
                              <div class="flex-grow-1 ms-3">
                                23 invoices have been paid to the MediCare Labs.
                              </div>
                            </div>
                            <p class="m-0 small">10:20AM Today</p>
                          </div>
                        </a>
                      </li>
                      <li class="activity-item pb-3 mb-3">
                        <a href="#!">
                          <h5 class="fw-regular">
                            <i class="ri-circle-fill text-info me-1"></i>
                            Purchased.
                          </h5>
                          <div class="ps-3 ms-2 border-start">
                            <div class="d-flex align-items-center mb-2">
                              <div class="flex-shrink-0">
                                <img src="assets/images/products/2.jpg" class="img-shadow img-3x rounded-1"
                                  alt="Hospital Admin Templates">
                              </div>
                              <div class="flex-grow-1 ms-3">
                                28 new surgical equipments have been purchased.
                              </div>
                            </div>
                            <p class="m-0 small">04:30PM Today</p>
                          </div>
                        </a>
                      </li>
                      <li class="activity-item pb-3 mb-3">
                        <a href="#!">
                          <h5 class="fw-regular">
                            <i class="ri-circle-fill text-success me-1"></i>
                            Appointed.
                          </h5>
                          <div class="ps-3 ms-2 border-start">
                            <div class="d-flex align-items-center mb-2">
                              <div class="flex-shrink-0">
                                <img src="assets/images/products/8.jpg" class="img-shadow img-3x rounded-1"
                                  alt="Hospital Admin Templates">
                              </div>
                              <div class="flex-grow-1 ms-3">
                                36 new doctors and 28 staff members appointed.
                              </div>
                            </div>
                            <p class="m-0 small">06:50PM Today</p>
                          </div>
                        </a>
                      </li>
                      <li class="activity-item">
                        <a href="#!">
                          <h5 class="fw-regular">
                            <i class="ri-circle-fill text-warning me-1"></i>
                            Requested
                          </h5>
                          <div class="ps-3 ms-2 border-start">
                            <div class="d-flex align-items-center mb-2">
                              <div class="flex-shrink-0">
                                <img src="assets/images/products/9.jpg" class="img-shadow img-3x rounded-1"
                                  alt="Hospital Admin Templates">
                              </div>
                              <div class="flex-grow-1 ms-3">
                                Requested for 6 new vehicles for medical emergency. .
                              </div>
                            </div>
                            <p class="m-0 small">08:30PM Today</p>
                          </div>
                        </a>
                      </li>
                    </ul>
                  </div>
                  <!-- Activity List Ends -->

                </div>
                <!-- Scroll ends -->

                <!-- View all button starts -->
                <div class="d-grid m-3">
                  <a href="javascript:void(0)" class="btn btn-primary">View all</a>
                </div>
                <!-- View all button ends -->

              </div>
            </div>
            <!-- Notifications dropdown ends -->

            <!-- Notifications dropdown starts -->
            <div class="dropdown">
              <a class="dropdown-toggle header-icon" href="#!" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="ri-alarm-warning-line"></i>
                <span class="count-label success"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-300">
                <h5 class="fw-semibold px-3 py-2 text-primary">Alerts</h5>

                <!-- Scroll starts -->
                <div class="scroll300">

                  <!-- Alert list starts -->
                  <div class="p-3">
                    <div class="d-flex py-2">
                      <div class="icon-box md bg-info rounded-circle me-3">
                        <span class="fw-bold fs-6 text-white">DS</span>
                      </div>
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">Douglass Shaw</h6>
                        <p class="mb-1">
                          Appointed as a new President 2014-2025
                        </p>
                        <p class="small m-0 opacity-50">Today, 07:30pm</p>
                      </div>
                    </div>
                    <div class="d-flex py-2">
                      <div class="icon-box md bg-danger rounded-circle me-3">
                        <span class="fw-bold fs-6 text-white">WG</span>
                      </div>
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">Willie Garrison</h6>
                        <p class="mb-1">
                          Congratulate, James for new job.
                        </p>
                        <p class="small m-0 opacity-50">Today, 08:00pm</p>
                      </div>
                    </div>
                    <div class="d-flex py-2">
                      <div class="icon-box md bg-warning rounded-circle me-3">
                        <span class="fw-bold fs-6 text-white">TJ</span>
                      </div>
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">Terry Jenkins</h6>
                        <p class="mb-1">
                          Lewis added new doctors training schedule.
                        </p>
                        <p class="small m-0 opacity-50">Today, 09:30pm</p>
                      </div>
                    </div>
                  </div>
                  <!-- Alert list ends -->

                </div>
                <!-- Scroll ends -->

                <!-- View all button starts -->
                <div class="d-grid m-3">
                  <a href="javascript:void(0)" class="btn btn-primary">View all</a>
                </div>
                <!-- View all button ends -->

              </div>
            </div>
            <!-- Notifications dropdown ends -->

            <!-- Messages dropdown starts -->
            <div class="dropdown">
              <a class="dropdown-toggle header-icon" href="#!" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="ri-message-3-line"></i>
                <span class="count-label"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-300">
                <h5 class="fw-semibold px-3 py-2 text-primary">Messages</h5>

                <!-- Scroll starts -->
                <div class="scroll300">

                  <!-- Messages list starts -->
                  <div class="p-3">
                    <div class="d-flex py-2">
                      <img src="assets/images/user3.png" class="img-shadow img-3x me-3 rounded-5"
                        alt="Hospital Admin Templates">
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">LOHDA BABBU</h6>
                        <p class="mb-1">
                          Appointed as a new President 2014-2025
                        </p>
                        <p class="small m-0 opacity-50">Today, 07:30pm</p>
                      </div>
                    </div>
                    <div class="d-flex py-2">
                      <img src="assets/images/user1.png" class="img-shadow img-3x me-3 rounded-5"
                        alt="Hospital Admin Templates">
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">Clyde Fowler</h6>
                        <p class="mb-1">
                          Congratulate, James for new job.
                        </p>
                        <p class="small m-0 opacity-50">Today, 08:00pm</p>
                      </div>
                    </div>
                    <div class="d-flex py-2">
                      <img src="assets/images/user4.png" class="img-shadow img-3x me-3 rounded-5"
                        alt="Hospital Admin Templates">
                      <div class="m-0">
                        <h6 class="mb-1 fw-semibold">Sophie Michiels</h6>
                        <p class="mb-1">
                          Lewis added new doctors training schedule.
                        </p>
                        <p class="small m-0 opacity-50">Today, 09:30pm</p>
                      </div>
                    </div>
                  </div>
                  <!-- Messages list ends -->

                </div>
                <!-- Scroll ends -->

                <!-- View all button starts -->
                <div class="d-grid m-3">
                  <a href="javascript:void(0)" class="btn btn-primary">View all</a>
                </div>
                <!-- View all button ends -->

              </div>
            </div>
          </div>
          <!-- Header actions ends -->

          <!-- Header user settings starts -->
          <div class="dropdown ms-2">
            <a id="userSettings" class="dropdown-toggle d-flex align-items-center" href="#!" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <div class="avatar-box"><span id="userInitials">--</span><span class="status busy"></span></div>
            </a>
            <div class="dropdown-menu dropdown-menu-end shadow-lg">
              <div class="px-3 py-2">
                <span class="small" id="userRole">User</span>
                <h6 class="m-0" id="userName">Loading...</h6>
              </div>
              <div class="mx-3 my-2 d-grid">
                <button id="logoutBtn" class="btn btn-danger">Logout</button>
              </div>
            </div>
          </div>
          <!-- Header user settings ends -->

        </div>
        <!-- App header actions ends -->

      </div>
      <!-- App header ends -->
      <!-- Main container starts -->
      <div class="main-container">
        <!-- Sidebar wrapper starts -->
        <nav id="sidebar" class="sidebar-wrapper">
          <!-- Sidebar profile starts -->
          <div class="sidebar-profile">
            <img src="assets/images/user6.png" class="img-shadow img-3x me-3 rounded-5" alt="Hospital Admin Templates">
            <div class="m-0">
              <h5 class="mb-1 profile-name text-nowrap text-truncate" id="sidebarUserName">Loading...</h5>
              <p class="m-0 small profile-name text-nowrap text-truncate" id="sidebarUserRole">User</p>
            </div>
          </div>
          <!-- Sidebar profile ends -->

          <!-- Sidebar menu starts -->
          <div class="sidebarMenuScroll">
            <ul class="sidebar-menu">
              <li class="active current-page">
                <a href="index.html">
                  <i class="ri-home-6-line"></i>
                  <span class="menu-text">Hospital Dashboard</span>
                </a>
              </li>
              
            

              <li class="treeview">
                <a href="#!">
                  <i class="ri-heart-pulse-line"></i>
                  <span class="menu-text">Patients</span>
                </a>
                <ul class="treeview-menu">
                  <li>
                    <a href="#">Patients Dashboard</a>
                  </li>
                  <li>
                    <a href="#">Patients List</a>
                  </li>
                  <li>
                    <a href="#">Add Patient</a>
                  </li>
                  <li>
                    <a href="#">Edit Patient Details</a>
                  </li>
                </ul>
              </li>
              <li class="treeview">
                <a href="#!">
                  <i class="ri-nurse-line"></i>
                  <span class="menu-text">Staff</span>
                </a>
                <ul class="treeview-menu">
                  <li>
                    <a href="#">Staff List</a>
                  </li>
                  <li>
                    <a href="#">Add Staff</a>
                  </li>
                  <li>
                    <a href="#">Edit Staff Details</a>
                  </li>
                </ul>
              </li>
              <li class="treeview">
                <a href="#!">
                  <i class="ri-dossier-line"></i>
                  <span class="menu-text">Appointments</span>
                </a>
                <ul class="treeview-menu">
                  <li>
                    <a href="#">Appointments</a>
                  </li>
                  <li>
                    <a href="#">Appointments List</a>
                  </li>
                  <li>
                    <a href="#">Book Appointment</a>
                  </li>
                  <li>
                    <a href="#">Edit Appointment</a>
                  </li>
                </ul>
              </li>

              <li class="treeview">
                <a href="#!">
                  <i class="ri-secure-payment-line"></i>
                  <span class="menu-text">Accounts</span>
                </a>
                <ul class="treeview-menu">
                  <li>
                    <a href="#">Income</a>
                  </li>
                  <li>
                    <a href="#">Payments</a>
                  </li>
                  
                </ul>
              </li>



             




              <li class="treeview">
                <a href="#!">
                  <i class="ri-login-circle-line"></i>
                  <span class="menu-text">Login/Signup</span>
                </a>
                <ul class="treeview-menu">
                  <li>
                    <a href="#">Login</a>
                  </li>
                  <li>
                    <a href="#">Signup</a>
                  </li>
                  <li>
                    <a href="#">Forgot Password</a>
                  </li>
                  <li>
                    <a href="#">Reset Password</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="#">
                  <i class="ri-alert-line"></i>
                  <span class="menu-text">Page Not Found</span>
                </a>
              </li>



            </ul>
          </div>
          <!-- Sidebar menu ends -->

          <!-- Sidebar contact starts -->
          <div class="sidebar-contact">
            <p class="fw-light mb-1 text-nowrap text-truncate">Emergency Contact</p>
            <h5 class="m-0 lh-1 text-nowrap text-truncate">0987654321</h5>
            <i class="ri-phone-line"></i>
          </div>
          <!-- Sidebar contact ends -->

        </nav>
        <!-- Sidebar wrapper ends -->

        <!-- App container starts -->
        <div class="app-container">

          <!-- App hero header starts -->
          <div class="app-hero-header d-flex align-items-center">

            <!-- Breadcrumb starts -->
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <i class="ri-home-8-line lh-1 pe-3 me-3 border-end"></i>
                <a href="index.html">Home</a>
              </li>
              <li class="breadcrumb-item text-primary" aria-current="page">
                Dashboard
              </li>
            </ol>
            <!-- Breadcrumb ends -->

            <!-- Sales stats starts -->
            <div class="ms-auto d-lg-flex d-none flex-row">
              <div class="d-flex flex-row gap-1 day-sorting">
                <button class="btn btn-sm btn-primary">Today</button>
                <button class="btn btn-sm">7d</button>
                <button class="btn btn-sm">2w</button>
                <button class="btn btn-sm">1m</button>
                <button class="btn btn-sm">3m</button>
                <button class="btn btn-sm">6m</button>
                <button class="btn btn-sm">1y</button>
              </div>
            </div>
            <!-- Sales stats ends -->

          </div>
          <!-- App Hero header ends -->

          <!-- App body starts -->
          <div class="app-body">

            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-xxl-12 col-sm-12">
                <div class="card mb-3 bg-2">
                  <div class="card-body">
                    <div class="py-4 px-3 text-white">
                      <h6 id="greetingTime">Good Morning,</h6>
                      <h2 id="greetingUserName">Loading...</h2>
                      <h5>Your schedule today.</h5>
                      <div class="mt-4 d-flex gap-3">
                        <div class="d-flex align-items-center">
                          <div class="icon-box lg bg-arctic rounded-3 me-3">
                            <i class="ri-surgical-mask-line fs-4"></i>
                          </div>
                          <div class="d-flex flex-column">
                            <h2 class="m-0 lh-1" id="patientsCount">0</h2>
                            <p class="m-0">Patients</p>
                          </div>
                        </div>
                        <div class="d-flex align-items-center">
                          <div class="icon-box lg bg-lime rounded-3 me-3">
                            <i class="ri-calendar-todo-line fs-4"></i>
                          </div>
                          <div class="d-flex flex-column">
                            <h2 class="m-0 lh-1" id="appointmentsCount">0</h2>
                            <p class="m-0">Appointments</p>
                          </div>
                        </div>
                        <div class="d-flex align-items-center">
                          <div class="icon-box lg bg-peach rounded-3 me-3">
                            <i class="ri-alert-line fs-4"></i>
                          </div>
                          <div class="d-flex flex-column">
                            <h2 class="m-0 lh-1" id="criticalPatientsCount">0</h2>
                            <p class="m-0">Critical Patients</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Row ends -->

            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-xl-3 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="p-2 border border-success rounded-circle me-3">
                        <div class="icon-box md bg-success-subtle rounded-5">
                          <i class="ri-surgical-mask-line fs-4 text-success"></i>
                        </div>
                      </div>
                      <div class="d-flex flex-column">
                        <h2 class="lh-1" id="newPatientCount">0</h2>
                        <p class="m-0">New Patients</p>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-1">
                      <a class="text-success" href="javascript:void(0);">
                        <span>View All</span>
                        <i class="ri-arrow-right-line text-success ms-1"></i>
                      </a>
                      <div class="text-end">
                        <p class="mb-0 text-success">+40%</p>
                        <span class="badge bg-success-subtle text-success small">this month</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="p-2 border border-info rounded-circle me-3">
                        <div class="icon-box md bg-info-subtle rounded-5">
                          <i class="ri-user-follow-line fs-4 text-info"></i>
                        </div>
                      </div>
                      <div class="d-flex flex-column">
                        <h2 class="lh-1" id="returnPatientCount">0</h2>
                        <p class="m-0">Return Patients</p>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-1">
                      <a class="text-info" href="javascript:void(0);">
                        <span>View All</span>
                        <i class="ri-arrow-right-line text-info ms-1"></i>
                      </a>
                      <div class="text-end">
                        <p class="mb-0 text-info">+25%</p>
                        <span class="badge bg-info-subtle text-info small">this month</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="p-2 border border-primary rounded-circle me-3">
                        <div class="icon-box md bg-primary-subtle rounded-5">
                          <i class="ri-lungs-line fs-4 text-primary"></i>
                        </div>
                      </div>
                      <div class="d-flex flex-column">
                        <h2 class="lh-1">360</h2>
                        <p class="m-0">OPD Patients</p>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-1">
                      <a class="text-primary" href="javascript:void(0);">
                        <span>View All</span>
                        <i class="ri-arrow-right-line ms-1"></i>
                      </a>
                      <div class="text-end">
                        <p class="mb-0 text-primary">+30%</p>
                        <span class="badge bg-primary-subtle text-primary small">this month</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="p-2 border border-danger rounded-circle me-3">
                        <div class="icon-box md bg-danger-subtle rounded-5">
                          <i class="ri-microscope-line fs-4 text-danger"></i>
                        </div>
                      </div>
                      <div class="d-flex flex-column">
                        <h2 class="lh-1">980</h2>
                        <p class="m-0">Lab tests</p>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-1">
                      <a class="text-danger" href="javascript:void(0);">
                        <span>View All</span>
                        <i class="ri-arrow-right-line ms-1"></i>
                      </a>
                      <div class="text-end">
                        <p class="mb-0 text-danger">+60%</p>
                        <span class="badge bg-danger-subtle text-danger small">this month</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <!-- Row ends -->

            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-verified-badge-line fs-4 lh-1"></i>
                      </div>
                      <h6>Appointments</h6>
                      <h2 class="text-primary m-0" id="totalAppointmentsCount">0</h2>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-stethoscope-line fs-4 lh-1"></i>
                      </div>
                      <h6>Doctors</h6>
                      <h2 class="text-primary m-0">83</h2>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-psychotherapy-line fs-4 lh-1"></i>
                      </div>
                      <h6>Staff</h6>
                      <h2 class="text-primary m-0">296</h2>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-lungs-line fs-4 lh-1"></i>
                      </div>
                      <h6>Operations</h6>
                      <h2 class="text-primary m-0">49</h2>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-hotel-bed-line fs-4 lh-1"></i>
                      </div>
                      <h6>Admitted</h6>
                      <h2 class="text-primary m-0">372</h2>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-2 col-sm-6 col-12">
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex flex-column align-items-center">
                      <div class="icon-box md rounded-5 bg-primary mb-3">
                        <i class="ri-walk-line fs-4 lh-1"></i>
                      </div>
                      <h6>Discharged</h6>
                      <h2 class="text-primary m-0">253</h2>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Row ends -->

            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-xxl-12 col-sm-12">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">All Patients</h5>
                  </div>
                  <div class="card-body">
                    <!-- Search, Filter, Export Controls -->
                    <div class="row mb-3 g-2">
                      <div class="col-12 col-sm-6 col-md-4">
                        <input type="text" class="form-control form-control-sm" id="patientSearchInput" placeholder="Search patients...">
                      </div>
                      <div class="col-12 col-sm-6 col-md-3">
                        <select class="form-select form-select-sm" id="patientConditionFilter">
                          <option value="">All Conditions</option>
                          <option value="HIV">HIV</option>
                          <option value="Diabetes">Diabetes</option>
                          <option value="Hypertension">Hypertension</option>
                          <option value="TB">TB</option>
                        </select>
                      </div>
                      <div class="col-12 col-sm-6 col-md-3">
                        <select class="form-select form-select-sm" id="patientStatusFilter">
                          <option value="">All Status</option>
                          <option value="Active">Active</option>
                          <option value="Inactive">Inactive</option>
                          <option value="Critical">Critical</option>
                          <option value="Alert">Alert</option>
                        </select>
                      </div>
                      <div class="col-12 col-sm-6 col-md-2">
                       <div class="export-icons-container">
                         <button class="export-icon-btn export-excel-btn" title="Export to Excel" onclick="exportPatientsToExcel()">
                           <i class="ri-file-excel-2-line"></i>
                         </button>
                         <button class="export-icon-btn export-pdf-btn" title="Export to PDF" onclick="exportPatientsToPDF()">
                           <i class="ri-file-pdf-fill"></i>
                         </button>
                       </div>
                      </div>
                    </div>
                    
                    <!-- Responsive Table with Horizontal Scroll on Mobile -->
                    <div class="table-responsive">
                      <table class="table table-hover table-sm patients-table">
                        <thead>
                           <tr>
                             <th>Patient ID</th>
                             <th>Name</th>
                             <th>Age</th>
                             <th>Gender</th>
                             <th>Phone</th>
                             <th>Address</th>
                             <th>Condition</th>
                             <th>Status</th>
                             <th>HIV Status</th>
                             <th>Notes</th>
                           </tr>
                         </thead>
                        <tbody id="patientsTableBody">
                          <tr>
                            <td colspan="8" class="text-center">Loading patients...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- Pagination Controls -->
                    <nav aria-label="Patient table pagination" class="mt-3">
                      <ul class="pagination pagination-sm justify-content-center" id="patientsPagination">
                        <li class="page-item">
                          <button class="page-link" id="prevPageBtn" onclick="previousPatientPage()">
                            <i class="ri-arrow-left-s-line"></i> <span class="d-none d-sm-inline">Prev</span>
                          </button>
                        </li>
                        <li class="page-item active" id="pageInfoLi">
                          <span class="page-link" id="pageInfo">Page 1</span>
                        </li>
                        <li class="page-item">
                          <button class="page-link" id="nextPageBtn" onclick="nextPatientPage()">
                            <span class="d-none d-sm-inline">Next</span> <i class="ri-arrow-right-s-line"></i>
                          </button>
                        </li>
                      </ul>
                    </nav>
                    <div class="text-center">
                      <small class="text-muted" id="patientCountInfo">Showing 0 of 0 patients</small>
                    </div>

                    <!-- Responsive Table CSS -->
                    <style>
                      /* Horizontal scroll on mobile devices */
                      @media (max-width: 767.98px) {
                        .table-responsive {
                          overflow-x: auto;
                          -webkit-overflow-scrolling: touch;
                          overflow-y: hidden;
                        }
                        
                        .patients-table {
                          min-width: 800px;
                          font-size: 0.85rem;
                          margin-bottom: 0;
                        }
                        
                        .patients-table thead {
                          position: sticky;
                          top: 0;
                          background-color: #f8f9fa;
                          z-index: 10;
                        }
                        
                        .patients-table th {
                          padding: 0.75rem 0.5rem !important;
                          white-space: nowrap;
                          font-weight: 600;
                          border-bottom: 2px solid #dee2e6;
                        }
                        
                        .patients-table td {
                          padding: 0.5rem !important;
                          white-space: nowrap;
                        }
                        
                        .badge {
                          font-size: 0.7rem;
                          padding: 0.35rem 0.5rem;
                        }
                      }

                      /* Table adjustments for tablets and above */
                      @media (min-width: 768px) {
                        .patients-table {
                          font-size: 0.95rem;
                        }
                        
                        .patients-table th,
                        .patients-table td {
                          padding: 0.75rem !important;
                        }
                      }

                      /* Standard scrollbar styling for mobile scroll */
                      .table-responsive {
                        scrollbar-width: thin;
                        scrollbar-color: #15696B #f0f0f0;
                      }

                      .table-responsive::-webkit-scrollbar {
                        height: 6px;
                      }

                      .table-responsive::-webkit-scrollbar-track {
                        background: #f0f0f0;
                        border-radius: 10px;
                      }

                      .table-responsive::-webkit-scrollbar-thumb {
                        background: #15696B;
                        border-radius: 10px;
                      }

                      .table-responsive::-webkit-scrollbar-thumb:hover {
                        background: #0F4449;
                      }
                    </style>
                  </div>
                </div>
              </div>
              <div class="col-xxl-6 col-sm-12">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Patients</h5>
                  </div>
                  <div class="card-body">
                    <!-- Chart removed - card only -->
                  </div>
                </div>
              </div>
              <div class="col-xxl-6 col-sm-12">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Treatment Type</h5>
                  </div>
                  <div class="card-body">
                    <div id="treatment"></div>
                  </div>
                </div>
              </div>
              <div class="col-xxl-6 col-sm-12">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Hospital Earnings</h5>
                  </div>
                  <div class="card-body">
                  </div>
                </div>
              </div>

              <div class="col-xxl-3 col-sm-6">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Insurance Claims</h5>
                  </div>
                  <div class="card-body">
                  </div>
                </div>
              </div>
              <div class="col-xxl-3 col-sm-6">
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="card-title">Patients by Gender</h5>
                  </div>
                  <div class="card-body">
                  </div>
                </div>
              </div>
            </div>
            <!-- Row ends -->

          </div>
          <!-- App body ends -->

          <!-- App footer starts -->
          <div class="app-footer bg-white">
            <span>Â© LULLA admin 2025</span>
          </div>
          <!-- App footer ends -->

        </div>
        <!-- App container ends -->

      </div>
      <!-- Main container ends -->

    </div>
    <!-- Page wrapper ends -->

    <!-- *************
			************ JavaScript Files *************
		************* -->
    <!-- Required jQuery first, then Bootstrap Bundle JS -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/moment.min.js"></script>

    <!-- Export Libraries -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>

    <!-- *************
    ************ Vendor Js Files *************
    ************* -->

    <!-- Overlay Scroll JS -->
    <script src="assets/js/jquery.overlayScrollbars.min.js"></script>
    <script src="assets/js/custom-scrollbar.js"></script>

    <!-- Apex Charts -->
    <script src="assets/js/apexcharts.min.js"></script>
    <script src="assets/js/patients.js"></script>
    <script src="assets/js/treatment.js"></script>
    <script src="assets/js/available-beds.js"></script>
    <script src="assets/js/earnings.js"></script>
    <script src="assets/js/gender-age.js"></script>
    <script src="assets/js/claims.js"></script>

    <!-- Custom JS files -->
    <script src="assets/js/custom.js"></script>

    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="supabase-config.js"></script>
    
    <!-- Dashboard Data Script -->
    <script src="dashboard-data.js"></script>

    <!-- Chatbot Handler Script -->
    <script src="chatbot-handler.js"></script>

    <!-- Smart Chatbot Matching Engine -->
    <script src="CHATBOT_SMART_MATCHING.js"></script>

    <!-- Authentication Check & Session Management -->
    <script>
      const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes in milliseconds
      let inactivityTimeout;

      // Initialize dashboard on page load
      document.addEventListener('DOMContentLoaded', function() {
        const sessionData = localStorage.getItem('healthflow_session');
        
        if (!sessionData) {
          // User is not logged in, redirect to login page
          window.location.href = 'login.html';
          return;
        }

        // Parse session data
        const session = JSON.parse(sessionData);

        // Display user information
        displayUserInfo(session);

        // Setup logout button
        setupLogoutButton();

        // Setup session timeout
        setupSessionTimeout();

        // Track user activity to reset inactivity timer
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('scroll', resetInactivityTimer);
      });

      // Display user information in header and sidebar
      function displayUserInfo(session) {
        const fullname = session.fullname || session.username || 'User';
        const userRole = session.userRole || 'User';

        // Get initials from fullname
        const initials = fullname
          .split(' ')
          .map(name => name.charAt(0))
          .join('')
          .toUpperCase()
          .slice(0, 2);

        // Update header dropdown UI
        document.getElementById('userInitials').textContent = initials;
        document.getElementById('userName').textContent = fullname;
        document.getElementById('userRole').textContent = userRole;

        // Update sidebar profile UI
        document.getElementById('sidebarUserName').textContent = fullname;
        document.getElementById('sidebarUserRole').textContent = userRole;

        // Update greeting section with real data
        updateGreetingSection(fullname, session);
      }

      // Update the greeting section with user info
      function updateGreetingSection(fullname, session) {
        // Update greeting time based on current hour
        const currentHour = new Date().getHours();
        let greeting = 'Good Morning';
        
        if (currentHour >= 12 && currentHour < 17) {
          greeting = 'Good Afternoon';
        } else if (currentHour >= 17) {
          greeting = 'Good Evening';
        }

        // Update greeting elements
        document.getElementById('greetingTime').textContent = greeting + ',';
        document.getElementById('greetingUserName').textContent = fullname;

        // Fetch and update real stats from database
        fetchDashboardStats(session);
        
        // Fetch and populate patients table
        fetchAndPopulatePatients(session);
      }

      // Fetch dashboard statistics from Supabase
      async function fetchDashboardStats(session) {
        try {
          // Use numeric facility_id from session
          const numericFacilityId = session.fid || session.facility_id || session.facilityId;

          // Fetch total patients for the facility
          const { data: patients, error: patientError } = await supabaseClient
            .from('patients')
            .select('*')
            .eq('fid', numericFacilityId);

          // Fetch total appointments from patients table (patients with art_start_date)
          const { count: totalAppointmentCount, error: totalAppointmentError } = await supabaseClient
            .from('patients')
            .select('*', { count: 'exact', head: true })
            .eq('fid', numericFacilityId)
            .not('art_start_date', 'is', null);
          
          console.log('Facility ID:', numericFacilityId, 'Total appointments count:', totalAppointmentCount, 'Error:', totalAppointmentError);

          // Fetch new patients registered in the current month
          const now = new Date();
          const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
          const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];
          
          const { data: newPatients, error: newPatientError } = await supabaseClient
            .from('patients')
            .select('pid')
            .eq('fid', numericFacilityId)
            .gte('patient_registration_date', monthStart)
            .lte('patient_registration_date', monthEnd);

          // Fetch critical patients needing special attention
          // This includes patients with:
          // - High viral load copies (>= 1000)
          // - Status marked as Critical or Alert or Inactive (lost to follow-up)
          let { data: allFacilityPatients, error: facilityPatientsError } = await supabaseClient
            .from('patients')
            .select('pid, viral_load_copies, status')
            .eq('fid', numericFacilityId);

          let criticalPatients = [];
          let criticalError = null;

          if (!facilityPatientsError && allFacilityPatients) {
            // Filter for critical patients: high viral load (>= 1000) or inactive status
            criticalPatients = allFacilityPatients.filter(patient => {
              const vl = parseInt(patient.viral_load_copies);
              return vl >= 1000 || ['Critical', 'Alert', 'Inactive'].includes(patient.status);
            });
          } else {
            criticalError = facilityPatientsError;
          }

          // Update UI with fetched data
          const patientCount = !patientError ? patients.length : 0;
          const newPatientCount = !newPatientError && newPatients ? newPatients.length : 0;
          const criticalPatientCount = !criticalError && criticalPatients ? criticalPatients.length : 0;
          const allAppointmentsCount = !totalAppointmentError ? totalAppointmentCount : 0;

          // Update only if elements exist
          const patientsCountEl = document.getElementById('patientsCount');
          const totalAppointmentsCountEl = document.getElementById('totalAppointmentsCount');
          const newPatientsCountEl = document.getElementById('newPatientsCount');
          const criticalPatientsCountEl = document.getElementById('criticalPatientsCount');

          if (patientsCountEl) patientsCountEl.textContent = patientCount;
          if (totalAppointmentsCountEl) totalAppointmentsCountEl.textContent = allAppointmentsCount;
          if (newPatientsCountEl) newPatientsCountEl.textContent = newPatientCount;
          if (criticalPatientsCountEl) criticalPatientsCountEl.textContent = criticalPatientCount;
        } catch (error) {
          console.error('Error fetching dashboard stats:', error);
        }
      }

      // Global variables for pagination and filtering
      let allPatients = [];
      let filteredPatients = [];
      let currentPatientPage = 1;
      const PATIENTS_PER_PAGE = 5;

      // Setup search and filter controls
       function setupPatientTableControls() {
         const searchInput = document.getElementById('patientSearchInput');
         const conditionFilter = document.getElementById('patientConditionFilter');
         const statusFilter = document.getElementById('patientStatusFilter');

         if (searchInput) searchInput.addEventListener('input', filterAndDisplayPatients);
         if (conditionFilter) conditionFilter.addEventListener('change', filterAndDisplayPatients);
         if (statusFilter) statusFilter.addEventListener('change', filterAndDisplayPatients);
       }

      // Filter and display patients based on search and filter inputs
      function filterAndDisplayPatients() {
        const searchTerm = document.getElementById('patientSearchInput').value.toLowerCase();
        const conditionFilter = document.getElementById('patientConditionFilter').value;
        const statusFilter = document.getElementById('patientStatusFilter').value;

        filteredPatients = allPatients.filter(patient => {
          const matchesSearch = !searchTerm || 
            (patient.patient_no && patient.patient_no.toLowerCase().includes(searchTerm)) ||
            (patient.first_name && patient.first_name.toLowerCase().includes(searchTerm)) ||
            (patient.last_name && patient.last_name.toLowerCase().includes(searchTerm));

          const matchesCondition = !conditionFilter || patient.condition === conditionFilter;
          const matchesStatus = !statusFilter || patient.status === statusFilter;

          return matchesSearch && matchesCondition && matchesStatus;
        });

        currentPatientPage = 1;
        displayPatientPage();
        updatePatientPaginationInfo();
      }

      // Display current page of patients
      function displayPatientPage() {
        const startIndex = (currentPatientPage - 1) * PATIENTS_PER_PAGE;
        const endIndex = startIndex + PATIENTS_PER_PAGE;
        const pagePatients = filteredPatients.slice(startIndex, endIndex);

        const tableBody = document.getElementById('patientsTableBody');

        if (pagePatients.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="10" class="text-center">No patients found</td></tr>';
          return;
        }

        // Table view (responsive with horizontal scroll on mobile)
         tableBody.innerHTML = pagePatients.map(patient => `
           <tr>
             <td>${patient.patient_no || '-'}</td>
             <td>${patient.first_name || '-'} ${patient.last_name || '-'}</td>
             <td>${patient.age || '-'}</td>
             <td>${patient.gender || '-'}</td>
             <td>${patient.phone_number || '-'}</td>
             <td>${patient.address || '-'}</td>
             <td><span class="badge bg-primary">${patient.condition || 'N/A'}</span></td>
             <td>
               <span class="badge ${getStatusBadgeClass(patient.status)}">
                 ${patient.status || 'Unknown'}
               </span>
             </td>
             <td>
               <span class="badge ${getHIVStatusBadgeClass(patient.hiv_status)}">
                 ${patient.hiv_status || 'Unknown'}
               </span>
             </td>
             <td>${patient.notes || '-'}</td>
           </tr>
         `).join('');
      }

      // Update pagination info and button states
      function updatePatientPaginationInfo() {
        const totalPages = Math.ceil(filteredPatients.length / PATIENTS_PER_PAGE);
        const pageInfo = document.getElementById('pageInfo');
        const prevBtn = document.getElementById('prevPageBtn');
        const nextBtn = document.getElementById('nextPageBtn');
        const countInfo = document.getElementById('patientCountInfo');

        if (pageInfo) pageInfo.textContent = `Page ${currentPatientPage} of ${totalPages}`;
        if (countInfo) {
          const startCount = Math.max(1, (currentPatientPage - 1) * PATIENTS_PER_PAGE + 1);
          const endCount = Math.min(filteredPatients.length, currentPatientPage * PATIENTS_PER_PAGE);
          countInfo.textContent = `Showing ${startCount} to ${endCount} of ${filteredPatients.length} patients`;
        }

        if (prevBtn) prevBtn.disabled = currentPatientPage === 1;
        if (nextBtn) nextBtn.disabled = currentPatientPage >= totalPages;
      }

      // Go to previous page
      window.previousPatientPage = function() {
        if (currentPatientPage > 1) {
          currentPatientPage--;
          displayPatientPage();
          updatePatientPaginationInfo();
        }
      };

      // Go to next page
      window.nextPatientPage = function() {
        const totalPages = Math.ceil(filteredPatients.length / PATIENTS_PER_PAGE);
        if (currentPatientPage < totalPages) {
          currentPatientPage++;
          displayPatientPage();
          updatePatientPaginationInfo();
        }
      };

      // Get patient data for export
       function getPatientExportData() {
         return {
           headers: ['Patient ID', 'First Name', 'Last Name', 'Age', 'Gender', 'Phone', 'Address', 'Condition', 'Status', 'HIV Status', 'Notes'],
           rows: filteredPatients.map(patient => [
             patient.patient_no || '',
             patient.first_name || '',
             patient.last_name || '',
             patient.age || '',
             patient.gender || '',
             patient.phone_number || '',
             patient.address || '',
             patient.condition || '',
             patient.status || '',
             patient.hiv_status || '',
             patient.notes || ''
           ])
         };
       }

      // Export patients to CSV
       window.exportPatientsToCSV = function() {
         const { headers, rows } = getPatientExportData();
         
         let csvContent = headers.join(',') + '\n';
         rows.forEach(row => {
           csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
         });

         const blob = new Blob([csvContent], { type: 'text/csv' });
         const url = window.URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `patients_${new Date().toISOString().split('T')[0]}.csv`;
         document.body.appendChild(a);
         a.click();
         document.body.removeChild(a);
         window.URL.revokeObjectURL(url);
       };

      // Export patients to Excel
       window.exportPatientsToExcel = function() {
         try {
           if (!window.XLSX) {
             throw new Error('XLSX library not loaded');
           }
           
           const { headers, rows } = getPatientExportData();
           const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
           
           // Set column widths
           ws['!cols'] = [
             {wch: 12}, {wch: 15}, {wch: 15}, {wch: 8}, {wch: 10}, 
             {wch: 20}, {wch: 15}, {wch: 12}, {wch: 15}, {wch: 20}
           ];
           
           const wb = XLSX.utils.book_new();
           XLSX.utils.book_append_sheet(wb, ws, 'Patients');
           XLSX.writeFile(wb, `patients_${new Date().toISOString().split('T')[0]}.xlsx`);
         } catch (error) {
           console.error('Error exporting to Excel:', error);
           Swal.fire({
             title: 'Export Failed',
             text: `Failed to export patients to Excel: ${error.message}`,
             icon: 'error',
             confirmButtonColor: '#15696B'
           });
         }
       };

      // Export patients to PDF
        window.exportPatientsToPDF = function() {
          try {
            if (!window.jspdf) {
              throw new Error('jsPDF library not loaded');
            }
            
            const { headers, rows } = getPatientExportData();
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape' });
           
           doc.setFontSize(16);
           doc.text('Patients Report', 14, 15);
           
           doc.setFontSize(10);
           doc.text(`Generated: ${new Date().toLocaleDateString()}`, 14, 25);
           
           doc.autoTable({
             head: [headers],
             body: rows,
             startY: 35,
             theme: 'grid',
             headStyles: {
               fillColor: [21, 105, 107],
               textColor: [255, 255, 255],
               fontStyle: 'bold',
               halign: 'center'
             },
             bodyStyles: {
               textColor: [0, 0, 0]
             },
             alternateRowStyles: {
               fillColor: [240, 240, 240]
             },
             margin: 10,
             didDrawPage: function(data) {
               // Add page number
               const pageSize = doc.internal.pageSize;
               const pageHeight = pageSize.getHeight();
               const pageWidth = pageSize.getWidth();
               doc.setFontSize(8);
               doc.text(`Page ${doc.internal.pages.length - 1}`, pageWidth - 20, pageHeight - 10);
             }
           });
           
           doc.save(`patients_${new Date().toISOString().split('T')[0]}.pdf`);
         } catch (error) {
           console.error('Error exporting to PDF:', error);
           Swal.fire({
             title: 'Export Failed',
             text: `Failed to export patients to PDF: ${error.message}`,
             icon: 'error',
             confirmButtonColor: '#15696B'
           });
         }
       };

      // Fetch and populate all patients in the table
      async function fetchAndPopulatePatients(session) {
        try {
          console.log('fetchAndPopulatePatients called with session:', session);
          
          // Check if supabaseClient is available
          if (!supabaseClient) {
            console.error('Supabase client not initialized');
            document.getElementById('patientsTableBody').innerHTML = 
              '<tr><td colspan="10" class="text-center text-danger">Supabase not initialized</td></tr>';
            return;
          }

          const numericFacilityId = session.fid || session.facility_id || session.facilityId;
          console.log('Fetching patients for facility ID:', numericFacilityId);
          
          // Fetch all patients for the facility with relevant fields
           const { data: patients, error: patientError } = await supabaseClient
             .from('patients')
             .select('patient_no, first_name, last_name, age, gender, phone_number, address, condition, status, hiv_status, notes')
             .eq('fid', numericFacilityId);

          console.log('Patients fetch result:', { patients, error: patientError });

          if (patientError) {
            console.error('Error fetching patients:', patientError);
            document.getElementById('patientsTableBody').innerHTML = 
              `<tr><td colspan="10" class="text-center text-danger">Error: ${patientError.message}</td></tr>`;
            return;
          }

          if (!patients || patients.length === 0) {
            document.getElementById('patientsTableBody').innerHTML = '<tr><td colspan="10" class="text-center">No patients found</td></tr>';
            return;
          }

          console.log('Fetched', patients.length, 'patients');

          // Store all patients for filtering
          allPatients = patients;
          filteredPatients = patients;
          currentPatientPage = 1;

          // Setup event listeners for search and filters
          setupPatientTableControls();

          // Display first page
          displayPatientPage();
          updatePatientPaginationInfo();
        } catch (error) {
           console.error('Error fetching and populating patients:', error);
           document.getElementById('patientsTableBody').innerHTML = 
             `<tr><td colspan="10" class="text-center text-danger">Error: ${error.message}</td></tr>`;
         }
      }

      // Helper function to get status badge class
      function getStatusBadgeClass(status) {
        switch(status) {
          case 'Active':
            return 'bg-success-subtle text-success';
          case 'Inactive':
            return 'bg-danger-subtle text-danger';
          case 'Critical':
            return 'bg-warning-subtle text-warning';
          case 'Alert':
            return 'bg-info-subtle text-info';
          default:
            return 'bg-secondary-subtle text-secondary';
        }
      }

      // Helper function to get HIV status badge class
      function getHIVStatusBadgeClass(hivStatus) {
        if (!hivStatus) return 'bg-secondary-subtle text-secondary';
        const status = hivStatus.toLowerCase();
        if (status.includes('positive')) {
          return 'bg-danger-subtle text-danger';
        } else if (status.includes('negative')) {
          return 'bg-success-subtle text-success';
        } else if (status.includes('unknown')) {
          return 'bg-warning-subtle text-warning';
        }
        return 'bg-secondary-subtle text-secondary';
      }

      // Setup logout button functionality
      function setupLogoutButton() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            logout();
          });
        }
      }

      // Logout function
      function logout() {
        // Clear session data
        localStorage.removeItem('healthflow_session');
        localStorage.removeItem('healthflow_email');

        // Clear inactivity timer
        if (inactivityTimeout) {
          clearTimeout(inactivityTimeout);
        }

        // Redirect to login page
        window.location.href = 'login.html';
      }

      // Setup session timeout on inactivity
      function setupSessionTimeout() {
        resetInactivityTimer();
      }

      // Reset inactivity timer
      function resetInactivityTimer() {
        // Clear existing timeout
        if (inactivityTimeout) {
          clearTimeout(inactivityTimeout);
        }

        // Set new timeout
        inactivityTimeout = setTimeout(function() {
          // Session expired due to inactivity
          const sessionData = localStorage.getItem('healthflow_session');
          if (sessionData) {
            // Show warning before logout
            Swal.fire({
              title: 'Session Expired',
              text: 'Your session has expired due to inactivity. Please login again.',
              icon: 'warning',
              confirmButtonColor: '#15696B',
              confirmButtonText: 'Login',
              allowOutsideClick: false,
              allowEscapeKey: false
            }).then((result) => {
              if (result.isConfirmed) {
                logout();
              }
            });
          }
        }, SESSION_TIMEOUT);
      }

      // Handle page visibility change (minimize/maximize)
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
          // Page is now visible, check session validity
          const sessionData = localStorage.getItem('healthflow_session');
          if (!sessionData) {
            window.location.href = 'login.html';
          }
        }
      });
    </script>
  </body>

</html>